<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
      integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <!-- <link rel="stylesheet" href="styles.css" /> -->
    <style>
      body {
        font-family: "Montserrat";
      }

      h1 {
        text-align: center;
      }

      .container {
        margin-block-start: 20px;
        margin-block-end: 20px;
        border-radius: 5px;
        background-color: #f2f2f2;
        padding: 20px;
      }

      .container span {
        color: red;
        font-weight: bold;
      }

      .item-title {
        display: flex;
        justify-content: space-between;
      }

      .note {
        color: red;
        font-weight: bold;
      }

      #container {
        width: 100%;
        margin: 20px auto;
      }
      .ck-editor__editable[role="textbox"] {
        /* editing area */
        min-height: 200px;
      }
      .ck-content .image {
        /* block images */
        max-width: 80%;
        margin: 20px auto;
      }

      label {
        color: #08a5a0;
      }

      .button {
        display: inline-block;
        padding: 1.3em 3em;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 2.5px;
        font-weight: 500;
        color: #000;
        background-color: #fff;
        border: none;
        border-radius: 45px;
        box-shadow: 0px 8px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease 0s;
        cursor: pointer;
        outline: none;
    }

    .button:hover {
    background-color: #08a5a0;
    box-shadow: 0px 15px 20px rgba(46, 229, 157, 0.4);
    color: #fff;
    transform: translateY(-7px);
    }

    .button:active {
    transform: translateY(-1px);
    }

    a {
        color: black;
        text-decoration: none;
    }

    a:visited {
        color: black;
    }
    </style>
    <title>License</title>
  </head>
  <div class="alert alert-success alert-dismissible fade show mt-3" id="alert-success" role="alert"
    style="position: fixed; top: 0; left: 0; width: 80%; z-index: 1000; margin-left: 10rem;" hidden>
    <strong>Yêu cầu chỉnh sửa được gửi đi thành công!</strong>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>

  <div class="alert alert-danger alert-dismissible fade show mt-3" id="alert-danger" role="alert"
      style="position: fixed; top: 0; left: 0; width: 80%; z-index: 1000; margin-left: 10rem;" hidden>
      <strong>Có lỗi xảy ra khi gửi yêu cầu chỉnh sửa!</strong>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>

  <div class="alert alert-warning alert-dismissible fade show mt-3" id="alert-warning" role="alert"
      style="position: fixed; top: 0; left: 0; width: 80%; z-index: 1000; margin-left: 10rem;" hidden>
      <strong id="warning-text">Vui lòng nhập đầy đủ và chính xác các trường thông tin!</strong>
      <button type="button" class="btn-close"></button>
  </div>
  
  <body>
    <div class="container-fluid d-flex bg-light">
      <div class="row">
        <%- include('./components/sidebar2.ejs', {role: role}); %>
      </div>
    <div class="container-fluid vw-80 p-5">
        <a href="/<%=role%>/license" class="button">Return</a>
      <h1>Yêu cầu cấp phép quảng cáo</h1>
      <form action="" class="row g-3">
        <div class="item-container col-md-6">
          <div class="item-title">
            <label for="bienqc" class="form-label">ID điểm đặt</label>
          </div>
          <input
            class="form-control"
            type="text"
            id="bienqc"
            name="bienqc"
            placeholder="ID Biển quảng cáo"
            disabled
          />
        </div>

        <div class="item-container col-md-6">
          <div class="item-title">
            <label for="diemqc" class="form-label">Điểm đặt biển</label>
            <span id="Diemqc">*</span>
          </div>
          <input
            class="form-control"
            type="text"
            id="diemqc"
            name="diemqc"
            placeholder="Điểm đặt tương ứng"
            autocomplete="on"
            list="spotList"
            required
          />
          <datalist id="spotList" style="display: none;">
            <% locations.forEach((spot) => { %>
                <option value="<%= spot.name; %>"></option>
            <% }); %>
        </datalist>
        </div>

        <div class="item-container">
          <div class="item-title">
            <label for="boardTypeName" class="form-label">Loại Bảng</label>
            <span id="Hthuc">*</span>
          </div>
          <input
            class="form-control"
            type="text"
            id="boardTypeName"
            name="hthuc"
            placeholder="Loại bảng quảng cáo"
            required
            list="boardTypeList"
          />
          <input type="text" class="form-control" id="boardType" hidden />
                        <datalist id="boardTypeList" style="display: none;">
                            <% boardtypes.forEach((type)=> { %>
                            <option value="<%= type.typeName; %>"></option>
                            <% }); %>
                        </datalist>
        </div>

        <div class="item-container col-md-4">
          <div class="item-title">
            <label for="slbienqc" class="form-label">Số lượng biển</label>
            <span id="Slbienqc">*</span>
          </div>
          <input
            class="form-control"
            type="number"
            id="slbienqc"
            name="slbienqc"
            placeholder="Số lượng biển quảng cáo"
            required
          />
        </div>

        <div class="item-container col-md-4">
          <div class="item-title">
            <label for="chieudai" class="form-label">Chiều dài biển(m)</label>
            <span id="Chieudai">*</span>
          </div>
          <input
            class="form-control"
            type="number"
            id="chieudai"
            name="chieudai"
            placeholder="Dài"
            required
          />
        </div>

        <div class="item-container col-md-4">
          <div class="item-title">
            <label for="chieurong" class="form-label">Chiều rộng biển(m)</label>
            <span id="Chieurong">*</span>
          </div>
          <input
            class="form-control"
            type="number"
            id="chieurong"
            name="chieurong"
            placeholder="Rộng"
            required
          />
        </div>

        <div class="item-container">
          <div class="item-title">
            <label for="dccty" class="form-label">Địa chỉ điểm đặt</label>
            <span id="Dccty">*</span>
          </div>
          <input
            class="form-control"
            type="text"
            id="dccty"
            name="dccty"
            placeholder="Địa chỉ điểm đặt"
            required
          />
        </div>

        <div class="item-container">
          <div class="item-title">
            <label for="tencty" class="form-label"
              >Tên công ty xin cấp phép</label
            >
            <span id="Tencty">*</span>
          </div>
          <input
            class="form-control"
            type="text"
            id="tencty"
            name="tencty"
            placeholder="Tên công ty"
            required
          />
        </div>

        <div class="item-container col-md-4">
          <div class="item-title">
            <label for="dcct" class="form-label">Địa chỉ công ty</label>
            <span id="Dcct">*</span>
          </div>
          <input
            class="form-control"
            type="text"
            id="dcct"
            name="dcct"
            placeholder="Địa chỉ công ty"
            required
          />
        </div>

        <div class="item-container col-md-4">
          <div class="item-title">
            <label for="mailcty" class="form-label">Email công ty</label>
            <span id="Mailcty">*</span>
          </div>
          <input
            class="form-control"
            type="text"
            id="mailcty"
            name="mailcty"
            placeholder="Email công ty"
            required
          />
        </div>

        <div class="item-container col-md-4">
          <div class="item-title">
            <label for="sdtcty" class="form-label">Điện thoại liên lạc</label>
            <span id="Sdtcty">*</span>
          </div>
          <input
            class="form-control"
            type="number"
            id="sdtcty"
            name="sdtcty"
            placeholder="Số điện thoại"
            required
          />
        </div>

        <div class="item-container col-md-6">
          <div class="item-title">
            <label for="startdate" class="form-label"
              >Ngày bắt đầu hợp đầu</label
            >
            <span id="Startdate">*</span>
          </div>
          <input
            class="form-control"
            type="date"
            id="startdate"
            name="startdate"
            placeholder="Ngày bắt đầu"
            required
          />
        </div>

        <div class="item-container col-md-6">
          <div class="item-title">
            <label for="enddate" class="form-label"
              >Ngày kết thúc hợp đồng</label
            >
            <span id="Enddate">*</span>
          </div>
          <input
            class="form-control"
            type="date"
            id="enddate"
            name="enddate"
            placeholder="Ngày kết thúc"
            required
          />
        </div>

        <div class="item-container col-md-6">
          <div class="item-title">
            <label for="formFileLg" class="form-label"
              >Hình ảnh minh họa 1</label
            >
            <span id="Anh1">*</span>
          </div>
          <input
            class="form-control"
            id="formFileLg1"
            type="file"
            accept="image/*"
            required
          />
        </div>

        <div class="item-container col-md-6">
          <div class="item-title">
            <label for="formFileLg" class="form-label"
              >Hình ảnh minh họa 2</label
            >
            <span id="Anh2">*</span>
          </div>

          <input
            class="form-control"
            id="formFileLg2"
            type="file"
            accept="image/*"
            required
          />
        </div>

        <div class="item-container">
          <div class="item-title">
            <label for="ndqc">Nội dung biển quảng cáo</label>
            <span id="Ndqc">*</span>
          </div>
          <div id="container">
            <div id="editor"></div>
          </div>
          <!--
                  The "super-build" of CKEditor&nbsp;5 served via CDN contains a large set of plugins and multiple editor types.
                  See https://ckeditor.com/docs/ckeditor5/latest/installation/getting-started/quick-start.html#running-a-full-featured-editor-from-cdn
              -->
          <script src="https://cdn.ckeditor.com/ckeditor5/40.2.0/super-build/ckeditor.js"></script>
          <!--
                  Uncomment to load the Spanish translation
                  <script src="https://cdn.ckeditor.com/ckeditor5/40.2.0/super-build/translations/es.js"></script>
              -->
          <script>
            var myEditor;
            // This sample still does not showcase all CKEditor&nbsp;5 features (!)
            // Visit https://ckeditor.com/docs/ckeditor5/latest/features/index.html to browse all the features.
            CKEDITOR.ClassicEditor
              .create(document.getElementById("editor"), {
              // https://ckeditor.com/docs/ckeditor5/latest/features/toolbar/toolbar.html#extended-toolbar-configuration-format
              toolbar: {
                items: [
                  "exportPDF",
                  "exportWord",
                  "|",
                  "findAndReplace",
                  "selectAll",
                  "|",
                  "heading",
                  "|",
                  "bold",
                  "italic",
                  "strikethrough",
                  "underline",
                  "code",
                  "subscript",
                  "superscript",
                  "removeFormat",
                  "|",
                  "bulletedList",
                  "numberedList",
                  "todoList",
                  "|",
                  "outdent",
                  "indent",
                  "|",
                  "undo",
                  "redo",
                  "-",
                  "fontSize",
                  "fontFamily",
                  "fontColor",
                  "fontBackgroundColor",
                  "highlight",
                  "|",
                  "alignment",
                  "|",
                  "link",
                  "uploadImage",
                  "blockQuote",
                  "insertTable",
                  "mediaEmbed",
                  "codeBlock",
                  "htmlEmbed",
                  "|",
                  "specialCharacters",
                  "horizontalLine",
                  "pageBreak",
                  "|",
                  "textPartLanguage",
                  "|",
                  "sourceEditing",
                ],
                shouldNotGroupWhenFull: true,
              },
              // Changing the language of the interface requires loading the language file using the <script> tag.
              // language: 'es',
              list: {
                properties: {
                  styles: true,
                  startIndex: true,
                  reversed: true,
                },
              },
              // https://ckeditor.com/docs/ckeditor5/latest/features/headings.html#configuration
              heading: {
                options: [
                  {
                    model: "paragraph",
                    title: "Paragraph",
                    class: "ck-heading_paragraph",
                  },
                  {
                    model: "heading1",
                    view: "h1",
                    title: "Heading 1",
                    class: "ck-heading_heading1",
                  },
                  {
                    model: "heading2",
                    view: "h2",
                    title: "Heading 2",
                    class: "ck-heading_heading2",
                  },
                  {
                    model: "heading3",
                    view: "h3",
                    title: "Heading 3",
                    class: "ck-heading_heading3",
                  },
                  {
                    model: "heading4",
                    view: "h4",
                    title: "Heading 4",
                    class: "ck-heading_heading4",
                  },
                  {
                    model: "heading5",
                    view: "h5",
                    title: "Heading 5",
                    class: "ck-heading_heading5",
                  },
                  {
                    model: "heading6",
                    view: "h6",
                    title: "Heading 6",
                    class: "ck-heading_heading6",
                  },
                ],
              },
              // https://ckeditor.com/docs/ckeditor5/latest/features/editor-placeholder.html#using-the-editor-configuration
              placeholder: "Nội dung biển quảng cáo",
              // https://ckeditor.com/docs/ckeditor5/latest/features/font.html#configuring-the-font-family-feature
              fontFamily: {
                options: [
                  "default",
                  "Arial, Helvetica, sans-serif",
                  "Courier New, Courier, monospace",
                  "Georgia, serif",
                  "Lucida Sans Unicode, Lucida Grande, sans-serif",
                  "Tahoma, Geneva, sans-serif",
                  "Times New Roman, Times, serif",
                  "Trebuchet MS, Helvetica, sans-serif",
                  "Verdana, Geneva, sans-serif",
                ],
                supportAllValues: true,
              },
              // https://ckeditor.com/docs/ckeditor5/latest/features/font.html#configuring-the-font-size-feature
              fontSize: {
                options: [10, 12, 14, "default", 18, 20, 22],
                supportAllValues: true,
              },
              // Be careful with the setting below. It instructs CKEditor to accept ALL HTML markup.
              // https://ckeditor.com/docs/ckeditor5/latest/features/general-html-support.html#enabling-all-html-features
              htmlSupport: {
                allow: [
                  {
                    name: /.*/,
                    attributes: true,
                    classes: true,
                    styles: true,
                  },
                ],
              },
              // Be careful with enabling previews
              // https://ckeditor.com/docs/ckeditor5/latest/features/html-embed.html#content-previews
              htmlEmbed: {
                showPreviews: true,
              },
              // https://ckeditor.com/docs/ckeditor5/latest/features/link.html#custom-link-attributes-decorators
              link: {
                decorators: {
                  addTargetToExternalLinks: true,
                  defaultProtocol: "https://",
                  toggleDownloadable: {
                    mode: "manual",
                    label: "Downloadable",
                    attributes: {
                      download: "file",
                    },
                  },
                },
              },
              // https://ckeditor.com/docs/ckeditor5/latest/features/mentions.html#configuration
              mention: {
                feeds: [
                  {
                    marker: "@",
                    feed: [
                      "@apple",
                      "@bears",
                      "@brownie",
                      "@cake",
                      "@cake",
                      "@candy",
                      "@canes",
                      "@chocolate",
                      "@cookie",
                      "@cotton",
                      "@cream",
                      "@cupcake",
                      "@danish",
                      "@donut",
                      "@dragée",
                      "@fruitcake",
                      "@gingerbread",
                      "@gummi",
                      "@ice",
                      "@jelly-o",
                      "@liquorice",
                      "@macaroon",
                      "@marzipan",
                      "@oat",
                      "@pie",
                      "@plum",
                      "@pudding",
                      "@sesame",
                      "@snaps",
                      "@soufflé",
                      "@sugar",
                      "@sweet",
                      "@topping",
                      "@wafer",
                    ],
                    minimumCharacters: 1,
                  },
                ],
              },
              // The "super-build" contains more premium features that require additional configuration, disable them below.
              // Do not turn them on unless you read the documentation and know how to configure them and setup the editor.
              removePlugins: [
                // These two are commercial, but you can try them out without registering to a trial.
                // 'ExportPdf',
                // 'ExportWord',
                "AIAssistant",
                "CKBox",
                "CKFinder",
                "EasyImage",
                // This sample uses the Base64UploadAdapter to handle image uploads as it requires no configuration.
                // https://ckeditor.com/docs/ckeditor5/latest/features/images/image-upload/base64-upload-adapter.html
                // Storing images as Base64 is usually a very bad idea.
                // Replace it on production website with other solutions:
                // https://ckeditor.com/docs/ckeditor5/latest/features/images/image-upload/image-upload.html
                // 'Base64UploadAdapter',
                "RealTimeCollaborativeComments",
                "RealTimeCollaborativeTrackChanges",
                "RealTimeCollaborativeRevisionHistory",
                "PresenceList",
                "Comments",
                "TrackChanges",
                "TrackChangesData",
                "RevisionHistory",
                "Pagination",
                "WProofreader",
                // Careful, with the Mathtype plugin CKEditor will not load when loading this sample
                // from a local file system (file://) - load this site via HTTP server if you enable MathType.
                "MathType",
                // The following features are part of the Productivity Pack and require additional license.
                "SlashCommand",
                "Template",
                "DocumentOutline",
                "FormatPainter",
                "TableOfContents",
                "PasteFromOfficeEnhanced",
              ],
            })
            .then(editor => {
              console.log('Editor is created');
              myEditor = editor
            })
            .catch((err) => {
              console.log(err.stack);
            });
          </script>
        </div>
        <div class="note" id="must">(*) : Bắt buộc</div>
      </form>
      <div class="d-flex mt-3 align-items-center justify-content-center">
        <button class="btn btn-primary" id="submitBtn" type="button">Gửi yêu cầu</button>
      </div>
    </div>
  </div>
  </body>
  <script defer>
    const upload2Imgur = async (files) => {
      const links = []
      console.log(files);
      for (let i = 0; i < files.length; i++) {
        let formData = new FormData()
        formData.append('image', files[i])
        const response = await fetch('/pic/posts', {
          method: 'POST',
          body: formData,
          redirect: 'follow'
        });
        const data = await response.json()
        links.push(data.message);
      }
      return links
    }
    
    const submitHandler = async (e) => {
      e.preventDefault();
      console.log(myEditor.getData());
      // Check spot name.
      const spotNameInput = document.getElementById('diemqc').value.trim();
      const spotList = JSON.parse('<%- JSON.stringify(locations); %>');
      if(spotNameInput == '' || !(spotList.some(spot => spot.name === spotNameInput))){
          document.getElementById('warning-text').textContent = "Vui lòng nhập đúng TÊN ĐIỂM ĐẶT.";
          document.getElementById('alert-warning').hidden = false;
          return;
      }
  
      // Check company name
      const companyName = document.getElementById('tencty').value.trim();
      if(companyName == ''){
          document.getElementById('warning-text').textContent = "Vui lòng nhập TÊN CÔNG TY";
          document.getElementById('alert-warning').hidden = false;
          return;
      }
  
      // Check phone number is digit ?
      const companyPhone = document.getElementById('sdtcty').value
      if(companyPhone == '' || !(/^\d+$/).test(companyPhone)){
          document.getElementById('warning-text').textContent = "Vui lòng nhập đúng SỐ ĐIỆN THOẠI (tất cả đồ là chữ số)";
          document.getElementById('alert-warning').hidden = false;
          return;
      }
  
      // Check email format
      const companyEmail = document.getElementById('mailcty').value;
      if(companyEmail == '' || !(/^[^\s@]+@[^\s@]+\.[^\s@]+$/).test(companyEmail)){
          document.getElementById('warning-text').textContent = "Vui lòng nhập đúng số ĐỊA CHỈ EMAIL (example@abc.xyz)";
          document.getElementById('alert-warning').hidden = false;
          return;
      }
  
      // Check company address
      const companyAddress = document.getElementById('dcct').value.trim();
      if(companyAddress == ''){
          document.getElementById('warning-text').textContent = "Vui lòng nhập ĐỊA CHỈ công ty";
          document.getElementById('alert-warning').hidden = false;
          return;
      }
  
      // Check startDate & EndDate
      const startDate = document.getElementById('startdate').value;
      const endDate = document.getElementById('enddate').value;
      console.log(startDate);
      console.log(endDate);
      const curDate = new Date();
      const sDate = new Date(startDate);
      if(startDate == '' || endDate == '' || startDate >= endDate || sDate <= curDate){
          document.getElementById('warning-text').textContent = "Vui lòng nhập đúng NGÀY BẮT ĐẦU và NGÀY KẾT THÚC";
          document.getElementById('alert-warning').hidden = false;
          return;
      }
  
      // Check board type (chưa có)
      const boardTypeInput = document.getElementById('boardTypeName').value.trim();
      const boardTypeList = JSON.parse('<%- JSON.stringify(boardtypes); %>');
      if(boardTypeInput == '' || !(boardTypeList.some(type => type.typeName === boardTypeInput))){
          document.getElementById('warning-text').textContent = "Vui lòng nhập đúng LOẠI BẢNG QUẢNG CÁO.";
          document.getElementById('alert-warning').hidden = false;
          return;
      }
  
      // Check quantity
      const quantity = document.getElementById('slbienqc').value
      if(quantity == '' || !(/^\d+$/).test(quantity) || Number.parseInt(quantity) > 10 || Number.parseInt(quantity) < 0){
          document.getElementById('warning-text').textContent = "Vui lòng nhập đúng SỐ LƯỢNG BẢNG / TRỤ (số nguyên từ 0 tới 10).";
          document.getElementById('alert-warning').hidden = false;
          return;
      }
  
      // Check height
      const height = document.getElementById('chieurong').value
      if(height == '' || Number.parseFloat(height) > 50.0 || Number.parseFloat(height) < 0.0){
          document.getElementById('warning-text').textContent = "Vui lòng nhập đúng CHIỀU CAO (từ 0 tới 50).";
          document.getElementById('alert-warning').hidden = false;
          return;
      }
  
      // Check width
      const width = document.getElementById('chieudai').value
      if(width == '' || Number.parseFloat(width) > 50.0 || Number.parseFloat(width) < 0.0){
          document.getElementById('warning-text').textContent = "Vui lòng nhập đúng CHIỀU RỘNG (từ 0 tới 50).";
          document.getElementById('alert-warning').hidden = false;
          return;
      }
  
      // Check content
      
      const content = myEditor.getData();
      if(content == ''){
          document.getElementById('warning-text').textContent = "Vui lòng nhập NỘI DUNG QUẢNG CÁO.";
          document.getElementById('alert-warning').hidden = false;
          return;
      }
  
      // ................................................
      const inputImage1 = document.getElementById('formFileLg1');
      const inputImage2 = document.getElementById('formFileLg2');
      const files = [];
      files.push(inputImage1.files);
      files.push(inputImage2.files);
  
      const imgUrls = await upload2Imgur(inputImage1.files);
      console.log(imgUrls);
  
      // Check image
      if(imgUrls.length == 0){
          document.getElementById('warning-text').textContent = "Vui lòng tải lên ÍT NHẤT MỘT ẢNH về bảng quảng cáo.";
          document.getElementById('alert-warning').hidden = false;
          loader.style.display = 'none';
          return;
      }
      // ................................................
  
      const data = {
        locationID: document.getElementById('bienqc').value,
        boardType: document.getElementById('boardType').value,
        quantity: Number.parseFloat(quantity),
        height: Number.parseFloat(height),
        width: Number.parseFloat(width),
        images: imgUrls,
        content: content,
        companyName: companyName,
        phoneNumber: companyPhone,
        companyEmail: companyEmail,
        companyAddress: companyAddress,
        startDate: startDate,
        endDate: endDate,
        officer: '<%= user.username %>',
        extendForBoard: '',
      }
      const url = '<%= url %>';
      const requestUrl = url.replace('/create', '');
  
      console.log(data);
      // console.log(requestUrl);
      const result = await fetch(requestUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data),
      });
      if (result.status == 200) {
          document.getElementById('alert-success').removeAttribute('hidden');
          // clear all input
          document.querySelectorAll('input').forEach((input) => {
              input.value = '';
          });
          document.getElementById('alert-success').addEventListener('closed.bs.alert', () => {
              console.log('1');
              const role = JSON.parse('<%- JSON.stringify(role); %>');
              window.location.href = `/${role}/license`;
          });
      } else {
          document.getElementById('alert-danger').hidden = false;
      }
  
      loader.style.display = 'none';
    }
  
    const boardTypes = JSON.parse('<%- JSON.stringify(boardtypes) %>');
    const boardTypeInput = document.getElementById("boardTypeName");
    const boardTypeID = document.getElementById("boardType");
  
    boardTypeInput.addEventListener('change', (e) => {
      const boardType = boardTypes.find(type => type.typeName === boardTypeInput.value);
      boardTypeID.value = boardType.boardTypeID;
    })
  
    document.getElementById('submitBtn').addEventListener('click', submitHandler);
  
    const spots = JSON.parse('<%- JSON.stringify(locations); %>');
    const spotIDInput = document.getElementById('bienqc');
    const spotNameInput = document.getElementById('diemqc');
    const spotAddressInput = document.getElementById('dccty');
    spotNameInput.addEventListener('keyup', (e) => {
      const spotName = e.target.value;
      const spot = spots.find((spot) => spot.name === spotName);
      if (spot) {
        spotIDInput.value = spot.id;
        spotAddressInput.value = spot.address;
      }
    })
    const curSpot = JSON.parse('<%- JSON.stringify(curSpot); %>');
    if(Object.keys(curSpot).length > 0){
      spotIDInput.value = curSpot.locationID;
      spotAddressInput.value = `${curSpot.address}, Phường ${curSpot.wardName}, Quận ${curSpot.districtName}`;
      spotNameInput.value = curSpot.locationName;
    }
  
    document.querySelectorAll('.btn-close').forEach((btn) => {
          btn.addEventListener('click', (e) => {
              e.preventDefault();
              e.target.parentElement.hidden = true;
          });
        });
  </script>
</html>